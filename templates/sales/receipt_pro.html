{% extends 'base/base_public.html' %}
{% load humanize %}

{% block title %}Reçu #{{ invoice.number }} — {{ shop.name }}{% endblock %}

{% block content %}
<style>
  /* Mobile-first receipt styles */
  .receipt { max-width: 480px; margin: 0 auto; background: #fff; border-radius:8px; padding:14px; box-shadow: 0 6px 18px rgba(15,23,42,0.06); }
  .r-header { display:flex; align-items:center; gap:12px; }
  .r-logo { width:56px; height:56px; border-radius:8px; background:linear-gradient(135deg,#4f46e5,#60a5fa); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:20px }
  .r-shop { font-weight:700; font-size:16px; color:#0f172a }
  .r-meta { font-size:12px; color:#475569 }
  .r-items { margin-top:12px; }
  .r-item { display:flex; justify-content:space-between; padding:8px 0; border-bottom: 1px dashed #e6eef8 }
  .r-item .left { max-width:60% }
  .r-summary { margin-top:10px; display:flex; justify-content:space-between; gap:8px; }
  .r-summary .label { color:#64748b; font-size:13px }
  .r-total { font-size:18px; font-weight:800; color:#0f172a }
  .r-actions { margin-top:14px; display:flex; gap:8px; }
  .btn { padding:8px 12px; border-radius:8px; font-weight:600; font-size:13px }
  .btn-primary{ background:#4f46e5; color:#fff }
  .btn-light{ background:#f1f5f9; color:#0f172a }

  /* Print styles (A5/A4 narrow) */
  @media print{ body{background:#fff} .receipt{box-shadow:none; border-radius:0; max-width:210mm; width:100%; padding:10mm} .r-actions{display:none} }
</style>

<div class="receipt">
  <div class="r-header">
    <div class="r-logo">{{ shop.name|slice:":1"|upper }}</div>
    <div>
      <div class="r-shop">{{ shop.name }}</div>
      {% if shop.address %}<div class="r-meta">{{ shop.address }}</div>{% endif %}
      {% if shop.phone %}<div class="r-meta">{{ shop.phone }}</div>{% endif %}
    </div>
  </div>

  <div class="mt-3">
    <div class="r-meta">Reçu #: <strong>#{{ invoice.number }}</strong></div>
    <div class="r-meta">Date: {{ sale.created_at|date:"d/m/Y H:i" }}</div>
    <div class="r-meta">Caissier: {% if sale.cashier %}{{ sale.cashier.username }}{% else %}-{% endif %}</div>
  </div>

  <div class="r-items">
    {% for item in sale.items.all %}
    <div class="r-item">
      <div class="left">
        <div class="text-sm text-gray-900">{{ item.product_name }}</div>
        <div class="text-xs text-gray-500">x{{ item.quantity }} • {{ item.price|intcomma }} FCFA</div>
      </div>
      <div class="right text-sm text-gray-900">{{ item.subtotal|intcomma }} FCFA</div>
    </div>
    {% endfor %}
  </div>

  <div class="r-summary">
    <div>
      <div class="label">Sous-total</div>
      <div class="label">Taxes</div>
      <div class="label">Remise</div>
    </div>
    <div style="text-align:right">
      <div class="label">{{ sale.subtotal|intcomma }} FCFA</div>
      <div class="label">{{ sale.tax_amount|default:0|intcomma }} FCFA</div>
      <div class="label">{{ sale.discount|default:0|intcomma }} FCFA</div>
    </div>
  </div>

  <div class="mt-3 flex items-center justify-between">
    <div class="text-sm text-gray-500">Paiement: <strong>{{ sale.payment_method }}</strong></div>
    <div class="r-total">Total: {{ sale.total_amount|intcomma }} FCFA</div>
  </div>

  <div class="r-actions">
    <button class="btn btn-primary" onclick="window.print();">Imprimer</button>
    <a class="btn btn-light" href="{% url 'sale_detail' invoice.id %}">Détails</a>
    {% if invoice.pdf_file %}
    <a class="btn btn-light" href="{{ invoice.pdf_file.url }}" target="_blank">Télécharger PDF</a>
    {% endif %}
  </div>
</div>

{% endblock %}
